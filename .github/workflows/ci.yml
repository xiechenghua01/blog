name: ci

on:
  push:
    branches:
      - main

permissions:
  contents: write

jobs:
  build-and-deploy:
    # æ„å»ºç¯å¢ƒä½¿ç”¨ ubuntu
    runs-on: ubuntu-latest

    steps:
      # å°†ä»£ç æ‹‰åˆ°è™šæ‹Ÿæœº
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v3

      # å®‰è£…nodejs
      - name: Use Node.js 18
        uses: actions/setup-node@v3
        with:
          node-version: '18.x'

      # æ„å»ºé¡¹ç›®
      - name: Build Project ğŸ“¦
        run: |
          yarn install
          yarn run build

      # éƒ¨ç½²åˆ°githubæŒ‡å®šåˆ†æ”¯
      - name: Deploy ğŸš€
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          # éƒ¨ç½²åæäº¤åˆ°çš„åˆ†æ”¯
          branch: gh-pages
          # è¿™é‡Œå¡«æ‰“åŒ…å¥½çš„ç›®å½•åç§°
          folder: 'build'

      - name: SSH Deploy ğŸ–¥ï¸
        uses: easingthemes/ssh-deploy@v2.2.11
        env:
          SSH_PRIVATE_KEY: ${{ secrets.PRIVATE_KEY }}
          ARGS: '-avzr --delete'
          SOURCE: 'build'
          REMOTE_HOST: ${{ secrets.REMOTE_HOST }}
          REMOTE_USER: 'ubuntu'
          TARGET: '/home/fontend/blog'
